# mariadb-ha-3node

一个基于 **Linux + Docker** 的  
**三节点、多地部署、强一致性（Quorum）MariaDB 高可用参考实现**。

本项目旨在给出一个**教科书级的多地热备最优解**，明确系统在各种失败场景下的行为，
避免隐式降级、脑裂或静默数据不一致。

---

## 项目动机

在真实世界中，多地数据库系统不可避免地面临：

- 网络不可靠
- 机房级故障
- 延迟与抖动
- 人为误操作

本项目选择 **正确性优先（Correctness over Availability）** 的设计路线，
在完全使用开源软件的前提下，构建一个：

- 行为可预测
- 失败语义明确
- 可复现、可教学
的 MariaDB 多地高可用架构示范。

---

## 设计原则

- 正确性优先于可用性
- 基于多数派（Quorum）的决策，而非经验性判断
- 显式失败语义，拒绝“悄悄写错”
- 不隐藏状态，不做隐式降级
- 失败要快、要明确、要可解释

---

## 架构概览

- 3 个 MariaDB 节点（1 主 + 2 从）
- 半同步复制（Semi-Synchronous Replication，ACK ≥ 1）
- ProxySQL：负责流量路由与读写隔离
- Orchestrator：负责拓扑感知与故障切换
- 第三节点作为**中立 Quorum 见证点**

详细设计说明见 `docs/` 目录。

---

## 项目范围

本仓库关注：
- 架构正确性
- 失败语义定义
- 行为边界与取舍说明

本仓库**刻意不关注**：
- 厂商特定优化
- 商业组件
- 无解释的“魔法自动化”

## 版本状态

### 当前稳定版本：v1.0.0

v1.0.0 是 mariadb-ha-3node 项目的奠基版本。

该版本完成了从**控制面事实定义**到**可被数据面消费的事实快照（facts.json）**的最小闭环，用于明确系统在任何不确定情况下的安全行为边界。

核心特性：

- 提供统一的控制面事实渲染脚本 `render_facts.sh`
- 生成原子、完整的运行期事实快照 `runtime/facts.json`
- 默认安全策略为 **reject_write（失败优先）**
- facts 渲染过程不做推断、不做补偿

当前版本**不包含**：

- MariaDB / ProxySQL 的实际运行与控制
- 自动故障检测与主从切换
- 仲裁、选主与性能优化

该版本作为后续所有高可用与自动化能力的**安全与语义基线**，已被冻结。

> 详细变更请参考 `CHANGELOG.md`
